# サーバーレス関数とCronJobを作成する

## 1. ユースケース名
サーバーレス関数とCronJobを作成する

## 2. アクター（実行者）
- **主アクター：** 個人開発者
- **副アクター：** Hexabase.AIシステム、メールサービス、Kubernetesスケジューラー

## 3. 事前条件
- 開発者がワークスペースを所有している
- 開発者がFunction作成の権限を持っている
- サマリーメール送信のためのビジネスロジックが準備されている
- メール送信に必要な外部サービス設定（SMTPまたはAPI）が利用可能である

## 4. 成功シナリオ（基本フロー）
1. 開発者がHexabase.AIダッシュボードの「Functions」セクションにアクセスする
2. 開発者が「新しいFunction作成」ボタンをクリックする
3. システムがFunction作成画面を表示する
4. 開発者がFunction名（例：`daily-summary-email`）を入力する
5. 開発者がランタイム（Node.js）を選択する
6. 開発者がメール送信のビジネスロジックをコードエディタに入力する
7. 開発者が環境変数（SMTP設定、APIキーなど）を設定する
8. 開発者が「Function作成」ボタンをクリックする
9. システムがFunctionをデプロイし、実行可能状態にする
10. 開発者が「CronJobs」セクションに移動する
11. 開発者が「新しいCronJob作成」ボタンをクリックする
12. 開発者がスケジュール（例：毎日午前9時）をcron形式で入力する
13. 開発者が実行するFunctionとして先ほど作成したFunctionを選択する
14. 開発者が「CronJob作成」ボタンをクリックする
15. システムがCronJobをスケジューラーに登録する
16. システムが設定完了メッセージと次回実行時刻を表示する

## 5. 代替シナリオ（代替フロー）
**5a. Function実行エラー**
- 9a. Functionのデプロイ中にエラーが発生する
- 9b. システムが詳細なエラーログを表示する
- 9c. 開発者がコードの構文エラーまたは依存関係を確認する
- 9d. 開発者がコードを修正して再デプロイする

**5b. 環境変数設定不備**
- 7a. 必要な環境変数が設定されていない
- 7b. Function実行時にエラーが発生する
- 7c. システムが環境変数関連のエラーメッセージを表示する
- 7d. 開発者が環境変数を追加・修正する

**5c. CronJob実行失敗**
- 15a. 初回スケジュール実行時にFunctionが失敗する
- 15b. システムが実行ログにエラーを記録する
- 15c. 開発者が実行ログを確認してエラー原因を特定する
- 15d. 開発者がFunctionまたはCronJob設定を修正する

**5d. スケジュール形式エラー**
- 12a. 入力されたcron形式が無効である
- 12b. システムがvalidationエラーメッセージを表示する
- 12c. 開発者が正しいcron形式で再入力する

## 6. 事後条件
- サーバーレスFunctionが作成・デプロイされている
- CronJobが指定されたスケジュールで登録されている
- 毎日指定された時刻にFunctionが自動実行される設定になっている
- Function実行ログが確認可能になっている
- 実行失敗時のアラート設定が有効になっている 