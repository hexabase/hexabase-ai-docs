# サインアップとワークスペースセットアップ

## 1. ユースケース名

サインアップとワークスペースセットアップ

## 2. アクター（実行者）

- **主アクター：** 個人開発者(以下、開発者)
- **副アクター：** Hexabase.AIシステム(以下、システム)
- **副アクター：** HKS CLI(CLIからHexabase.AIシステムを利用するためのツール)
- **副アクター：** OAuth2サービスプロバイダー(Google、GitHub等)

## 3. 事前条件

- インターネット接続が利用可能である
- 任意のOAuth2サービスプロバイダーのアカウントを所持している
- ブラウザまたはHKS CLIが利用可能である

## 4. 成功シナリオ（基本フロー）

1. 開発者がHexabase.AIプラットフォームにサインアップする
2. ブラウザーから利用：システムはOAuth2サービスプロバイダーの認可画面にリダイレクトする<br>
   HKS CLIから利用：ブラウザを開き、OAuth2サービスプロバイダーの認可画面を表示する。ただし、一部環境ではブラウザを自動で開けない場合があり、その場合は認可用URLを出力し、開発者が手動でブラウザに貼り付けて認可画面を開く
3. 開発者はOAuth2の認可を行う
4. システムが新規ユーザーであることを検出する
5. システムが自動的に個人用の組織とワークスペース（例：`dev-workspace`）を作成する
6. システムがプライベートKubernetesネームスペースを開発者に割り当てる
7. 開発者がHexabase.AIプラットフォームにログインする
8. システムがワークスペースの初期設定画面を表示する
9. 開発者がワークスペース名を確認または変更する
10. システムがワークスペースのセットアップを完了する
11. システムがダッシュボードを表示し、開発者は利用可能なリソースとクォータを確認する

## 5. 代替シナリオ（代替フロー）

**5a. 既存ユーザーがサインアップを試行**

- 2a. システムは開発者に既存ユーザーであることを通知し、ログインを促す
- 2b. ユーザーはログインを行う

**5b. OAuth2認証が失敗**

- 3a. システムは認可失敗を検知し、開発者にエラーを表示する
- 3b. 開発者はエラーを確認後、再度OAuth2の認可を行う
- 3c. 問題が解決しない場合、開発者はHexabase.AIシステムサポートに連絡する

**5c. ワークスペース作成失敗**

- 5a. システムがアクセス集中により、リソースが不足しワークスペース作成が失敗する
- 5b. システムは開発者にエラーメッセージを表示する
- 5c. 開発者は一定時間待った後に再試行する、解決しない場合はHexabase.AIシステムサポートに連絡する

**5d. ネットワーク接続問題**

- 1a. ログイン中にネットワーク接続が失われる
- 1b. ブラウザーがネットワーク接続のエラーを表示する
- 1c. 開発者が接続を確認して再度ログインを試行する

## 6. 事後条件

- 開発者専用の隔離されたワークスペースが作成されている
- 開発者がダッシュボードにアクセスできる状態になっている
- Hexabase.AIシステムでプライベートKubernetesネームスペースが割り当てられている
- プライベートKubernetesにリソースクォータと制限が設定されている

## 7. 仕様未定／要検討

- 4.5 TODO:ワークスペースの初期名を確認、もしくはここでの記載は不要？
- 4.7 TODO:ブラウザーの場合再ログインは必要か？そのままログイン後の状態にブラウザは自動で遷移するか？
- 4.9 TODO:開発者がワークスペース名を確認または変更する工程は不要か？
- 5a-2c TODO: アカウント削除 & 再作成は可能か？確認する
