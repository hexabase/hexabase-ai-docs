# 集中ガバナンスとSSO統合を設定する

## 1. ユースケース名
集中ガバナンスとSSO統合を設定する

## 2. アクター（実行者）
- **主アクター：** IT部門管理者
- **副アクター：** Hexabase.AIシステム、SSOプロバイダー（Okta/Azure AD）、エンタープライズユーザー

## 3. 事前条件
- エンタープライズプランが契約済みである
- 既存のSSOプロバイダー（Okta、Azure ADなど）が運用されている
- 企業の内部組織構造とロール定義が明確化されている
- SAML/OIDCの技術仕様について理解している担当者がいる

## 4. 成功シナリオ（基本フロー）
1. IT部門管理者がHexabase.AIエンタープライズダッシュボードにログインする
2. 管理者が「組織設定」→「SSO統合」セクションにアクセスする
3. システムがSSO設定ウィザードを表示する
4. 管理者がSSOプロバイダータイプ（Okta）を選択する
5. 管理者がOktaのメタデータURL、Entity ID、証明書情報を入力する
6. システムがSSO設定の検証を実行する
7. 管理者がテストユーザーでSSO認証をテストする
8. システムがSSO認証が成功したことを確認する
9. 管理者が「カスタムロール管理」セクションに移動する
10. 管理者が企業の組織構造に基づいたカスタムロールを作成する
11. 管理者が各部門（Finance、Engineering、Operations）に対応するロールを定義する
12. 管理者が各ロールに対する詳細な権限（リソース作成、削除、閲覧など）を設定する
13. システムがロール設定をRBACシステムに適用する
14. 管理者がSSO属性マッピングを設定し、Oktaのグループ情報をHexabaseロールにマッピングする
15. 管理者が「組織ポリシー」を設定し、パスワード要件、セッション管理などを構成する
16. システムが全設定を保存し、SSO統合を有効化する

## 5. 代替シナリオ（代替フロー）
**5a. SSO認証失敗**
- 7a. テストユーザーでのSSO認証が失敗する
- 7b. システムが詳細なエラーログ（証明書、メタデータエラーなど）を表示する
- 7c. 管理者がSSOプロバイダー設定を確認・修正する
- 7d. 管理者がSSO設定を再テストする

**5b. 属性マッピングエラー**
- 14a. SSO属性のマッピングが正しく動作しない
- 14b. ユーザーが期待されるロールで認証されない
- 14c. 管理者がOktaグループ設定とマッピング設定を確認する
- 14d. 管理者が属性マッピングを修正し、再テストする

**5c. 権限設定の競合**
- 12a. 設定した権限に矛盾や競合が存在する
- 12b. システムが権限競合の警告を表示する
- 12c. 管理者が権限設定を見直し、競合を解決する

**5d. 既存ユーザーの移行問題**
- 16a. SSO有効化後、既存の非SSOユーザーがアクセスできなくなる
- 16b. システムが移行ガイドと一時的なアクセス方法を提示する
- 16c. 管理者が段階的移行プランを実行する

## 6. 事後条件
- SSOプロバイダーとHexabase.AIが正常に統合されている
- 企業の内部組織構造に対応したカスタムロールが設定されている
- ユーザーが企業のIDプロバイダーでシームレスに認証できる
- きめ細かなRBAC権限が有効になっている
- 組織全体のセキュリティポリシーが適用されている
- 中央集権的な組織管理が実現されている
- 監査ログが有効になり、全アクティビティが記録されている 